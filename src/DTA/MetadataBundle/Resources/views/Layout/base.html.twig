<!DOCTYPE html>
<html lang="de">
    <!-- the basic html skeleton is generated by base.html.twig -->
    <head>
        {% include("DTAMetadataBundle::head.html.twig") %}
    </head>
    
    <body style="min-width: 900px">

        {%block mainMenu%}
        {% include 'DTAMetadataBundle:Layout:mainMenu.html.twig' %}
        {%endblock %}
        
        <div class="container-fluid" style="padding: 0 30px;">
            
        {#  ---------------------------------------------
            The content goes into the core block 
            --------------------------------------------- #}
                
            {# fluid: Allow stacking of sidebar and main content if too few space is available #}
            <div class="row" id="core" style="padding-left: 10px">
                {% for flashType, cssClass in {'error':'alert-danger','warning':'alert-warning','success':'alert-success'} %}
                    {% for flashMessage in app.session.flashbag.get(flashType) %} 
                    <div class="alert alert-dismissable {{cssClass}}">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        {{ flashMessage|raw }} 
                    </div>
                {% endfor %}
                {% endfor %}
                {% block core %}
                {% endblock %}
            </div><!--/row-->
            
            
            <footer>
            {% block footer %}
                <!--
                <hr/>
                <p>© DTA(v 2.0)</p>
                -->
            {% endblock %}
            </footer>

        </div><!--/.fluid-container-->

        <!-- Placed at the end of the document so the pages load faster -->
        {#<script src="{{ asset('js/jquery.min.js') }}"></script>#}
        {#<script src="{{ asset('js/jquery-ui.min.js') }}"></script>#}
        
        <script type="text/javascript">

            /*function thisHeight(){
                return $(this).height();
            }
            $(".top").height(function() {
                return Math.max.apply(Math, $(this).children().map(thisHeight));
            });*/
            // Plugin
           /* $.fn.equalize = function() {
                var maxHeight = 0;

                return this.each(function(){
                    var $this = $(this);

                    if ($(this).height() > maxHeight) { maxHeight = $(this).height(); }

                    $this.height(maxHeight);
                });
            };*/

            //var h = Math.max.apply(Math, $.map($(‘.el’),function(el){return $(el).height()}));


            //var scrolly = 0;
            //window.addEventListener("DOMContentLoaded", adjustTableHeight, false);

            // this script block is defined in the base.html.twig template.
            var dataTable;
            $(document).ready(function() {

                // automatically focus the first form input
                $('form:first input:first').focus();

                // confirm functionality
                $('a.confirmClick').on('click', confirmCriticalAction);

                // set size of textareas
                $('textarea').autosize();

                // ------------------------------------------------------
                // DataTables plugin setup
                // ------------------------------------------------------

                {% if package is defined and className is defined %}
                        // TODO remove debug output
                        console.log('retrieving records {{package}}\{{className}}');
                        // buttons with bootstrap CSS classes
                        {#$.extend( true, $.fn.DataTable.TableTools.classes, {
                                "container": "btn-group",
                                "buttons": {
                                        "normal": "btn btn-default",
                                        "disabled": "btn disabled"
                                },
                                "collection": {
                                        "container": "DTTT_dropdown dropdown-menu",
                                        "buttons": {
                                                "normal": "",
                                                "disabled": "disabled"
                                        }
                                }
                        } );

                        // Have the collection use a bootstrap compatible dropdown
                        $.extend( true, $.fn.DataTable.TableTools.DEFAULTS.oTags, {
                                "collection": {
                                        "container": "ul",
                                        "button": "div",
                                        "liner": "a"
                                }
                        } );#}


                        dataTable = $('.table.fullyFeatured');
                        //var topHeight = Math.max.apply(Math, $.map($('.top'),function(el){return $(el).height()}));

                        var paginationControlsHeight = 45;
                        var filterInputHeight = 50;//$('#datatable_filter').outerHeight();
                        //console.debug(filterInputHeight);
                        var tableHeaderHeight = $('thead').first().outerHeight();
                        //console.debug(tableHeaderHeight);
                        var tableTop = dataTable.offset().top;
                        var tableHeight = $(window).innerHeight() - tableTop - tableHeaderHeight - paginationControlsHeight - filterInputHeight;
                        //console.debug(tableHeight);


                        dataTable.DataTable( {

                            "processing": true
                            ,"serverSide": true
                            ,"ajax": "{{path(package~'_dataTablesDataSource', {'package': package, 'className': className}) }}"
                            ,"ordering":true // disables sorting completely
                            ,"searching":true // disables filtering
                            ,orderClasses: false
                            ,order:[]
                            ,"lengthMenu": [
                                [10, 50, 100, -1],
                                [10, 50, 100, "Alle"] ]
                            ,"pageLength" : 50
                            ,"dom": '<"top"fl>rt<"bottom"ip>'
                            ,"scrollY": tableHeight+"px"//"1px"
                            ,"paging": true
                            ,"pagingType": "full_numbers"
                            ,"language": { "url": "{{asset('js/DataTables-1.10.4/dataTablesGermanTranslation.json')}}" }
                      {#    ,"oTableTools": {
                                    "aButtons": [
                                            "copy"
                                            ,"print"
                                            /*,{
                                                    "sExtends":    "collection"
                                                    ,"sButtonText": 'Save <span class="caret" />'
                                                    ,"aButtons":    [ "csv", "xls", "pdf" ]
                                            }*/
                                    ]
                            }      #}
                        } );
                    $("#datatable_filter input").attr('placeholder', 'wildcards: _ und %');



                //adjustTableHeight();

                //dataTable.css('height',100);
                //var tableSettings = dataTable.;
                //console.debug(tableSettings);
                //tableSettings.oScroll.sY = 101;
                //var scrollBody = $('.table.fullyFeatured').first();
                //console.debug(scrollBody.style);//.style.height = '100px';
                 //   $('div.dataTables_wrapper').height();

                        {#var tt = new $.fn.dataTable.TableTools( $('.table.fullyFeatured') );

                        $( tt.fnContainer() ).insertBefore('div.dataTables_wrapper');#}
                {% endif %}

                //adjustTableHeight();

            });


            $(window).on('resize', function () {
                //dataTable = $('table.table');
                //console.debug(dataTable);
                dataTable.columns.adjust();
                //adjustTableHeight();

            } );

            function adjustTableHeight(){
                //if(scrolly==0) {

                $('.dta-data-options').css('visibility', 'hidden');
                $('.dataTables_scrollBody').css('height', 0);
                dataTable.draw();
                var scrolly = $(window).innerHeight() - $('html').outerHeight();
                //scrolly = $(window).height() - $('html').height();
                //var tableWrapper = $('.dataTables_wrapper').first();
                //var container = $('.dataTables_wrapper').parent();
                //console.debug($('html').height());
                console.debug("html: \t" + $('html').height());
                console.debug("window: \t" + $(window).height());

                $('.dta-data-options').css('visibility', 'visible');
                $('.dataTables_scrollBody').css('height', scrolly);
                //$('.dta-data-options').css('visibility', 'visible');
                //}
            }
            /**
             * Requests a confirmation on clicking a link which e.g. deletes something.
             * Uses the link's title attribute to determine the warning message for the dialog.
             * @param event the jquery event to stop the click action if necessary
             */
            function confirmCriticalAction(event){
                if(confirm($(this).attr('title'))){
                    return true;
                } else {
                    event.preventDefault();
                };
            }
            
            {% block additionalJS %}
            {% endblock %}

        </script>
    </body>
</html>