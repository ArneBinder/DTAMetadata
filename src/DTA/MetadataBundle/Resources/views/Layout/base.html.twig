<!DOCTYPE html>
<html lang="de">
    <!-- the basic html skeleton is generated by base.html.twig -->
    <head>
        {% include("DTAMetadataBundle::head.html.twig") %}
    </head>
    
    <body style="min-width: 900px">

        {%block mainMenu%}
        {% include 'DTAMetadataBundle:Layout:mainMenu.html.twig' %}
        {%endblock %}
        
        <div class="container-fluid" style="padding: 0 30px;">
            
        {#  ---------------------------------------------
            The content goes into the core block 
            --------------------------------------------- #}
                
            {# fluid: Allow stacking of sidebar and main content if too few space is available #}
            <div class="row" id="core" style="padding-left: 10px">
                {% for flashType, cssClass in {'error':'alert-danger','warning':'alert-warning','success':'alert-success'} %}
                    {% for flashMessage in app.session.flashbag.get(flashType) %} 
                    <div class="alert alert-dismissable {{cssClass}}">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        {{ flashMessage|raw }} 
                    </div>
                {% endfor %}
                {% endfor %}
                {% block core %}
                {% endblock %}
            </div><!--/row-->
            
            
            <footer>
            {% block footer %}
                <!--
                <hr/>
                <p>© DTA(v 2.0)</p>
                -->
            {% endblock %}
            </footer>

        </div><!--/.fluid-container-->

        <!-- Placed at the end of the document so the pages load faster -->
        {#<script src="{{ asset('js/jquery.min.js') }}"></script>#}
        {#<script src="{{ asset('js/jquery-ui.min.js') }}"></script>#}
        {% set search = (enableSearch|default(false))?'true':'false' %}
        <script type="text/javascript">

            /*function thisHeight(){
                return $(this).height();
            }
            $(".top").height(function() {
                return Math.max.apply(Math, $(this).children().map(thisHeight));
            });*/
            // Plugin
           /* $.fn.equalize = function() {
                var maxHeight = 0;

                return this.each(function(){
                    var $this = $(this);

                    if ($(this).height() > maxHeight) { maxHeight = $(this).height(); }

                    $this.height(maxHeight);
                });
            };*/

            //var h = Math.max.apply(Math, $.map($(‘.el’),function(el){return $(el).height()}));


            //var scrolly = 0;
            //window.addEventListener("DOMContentLoaded", adjustTableHeight, false);

            // this script block is defined in the base.html.twig template.
            var dataTable;
            $(document).ready(function() {

                // automatically focus the first form input
                $('form:first input:first').focus();

                // confirm functionality
                $('a.confirmClick').on('click', confirmCriticalAction);

                // set size of textareas
                $('textarea').autosize();

                // ------------------------------------------------------
                // DataTables plugin setup
                // ------------------------------------------------------

                {% if package is defined and className is defined %}
                        // TODO remove debug output
                if($('.table.fullyFeatured').length){
                        console.log('retrieving records {{package}}\{{className}}');
                        // buttons with bootstrap CSS classes
                        {#$.extend( true, $.fn.DataTable.TableTools.classes, {
                                "container": "btn-group",
                                "buttons": {
                                        "normal": "btn btn-default",
                                        "disabled": "btn disabled"
                                },
                                "collection": {
                                        "container": "DTTT_dropdown dropdown-menu",
                                        "buttons": {
                                                "normal": "",
                                                "disabled": "disabled"
                                        }
                                }
                        } );

                        // Have the collection use a bootstrap compatible dropdown
                        $.extend( true, $.fn.DataTable.TableTools.DEFAULTS.oTags, {
                                "collection": {
                                        "container": "ul",
                                        "button": "div",
                                        "liner": "a"
                                }
                        } );#}


                        dataTable = $('.table.fullyFeatured');

                        dataTable.DataTable( {
                            "processing": true
                            ,"serverSide": true
                            ,"ajax": "{{path(package~'_dataTablesDataSource', {'package': package, 'className': className}) }}"
                            ,"ordering":true // disables sorting completely
                            ,"searching":{{ search }}//true // disables filtering
                            ,orderClasses: false
                            ,order:[]
                            ,"lengthMenu": [
                                [10, 50, 100, -1],
                                [10, 50, 100, "Alle"] ]
                            ,"pageLength" : 50
                            ,"dom": '<"top"fl>rt<"bottom"ip>'
                            ,"scrollY": calcTableHeight()+"px"//"1px"//
                            ,"paging": true
                            ,"pagingType": "full_numbers"
                            ,"language": { "url": "{{asset('js/DataTables-1.10.4/dataTablesGermanTranslation.json')}}" }
                      {#    ,"oTableTools": {
                                    "aButtons": [
                                            "copy"
                                            ,"print"
                                            /*,{
                                                    "sExtends":    "collection"
                                                    ,"sButtonText": 'Save <span class="caret" />'
                                                    ,"aButtons":    [ "csv", "xls", "pdf" ]
                                            }*/
                                    ]
                            }      #}
                        } );
                    $("#datatable_filter input").attr('placeholder', 'wildcards: _ und %');
                }


                {% endif %}


            });


            $(window).on('resize', function () {
                if(dataTable!=null)
                {
                    dataTable.columns.adjust();
                    adjustTableHeight();
                    //$('.dataTables_scrollBody').css('height', calcTableHeight());
                }
            } );

            function adjustTableHeight(){

                options = $('.dta-data-options');
                listing = $('.dta-data-listing');
                scrollBody = $('.dataTables_scrollBody');

                listingTop = listing.offset().top;
                optionsTop = options.offset().top;
                //console.debug(optionHeight);
                options.css('height', 0);
                options.css('overflow', 'hidden');
                scrollBody.css('height', 0);
                dataTable.draw();
                var scrolly = $(window).innerHeight() - $('html').outerHeight();

                options.css('height', '');
                options.css('overflow', '');
                if(listingTop != optionsTop) {
                    //console.debug(listingTop);
                    console.debug(options.outerHeight());
                    scrolly = Math.max(0, scrolly - options.outerHeight());
                }
                scrollBody.css('height', scrolly);
            }

            function calcTableHeight(){
                var paginationControlsHeight = 45;
                var filterInputHeight = 50;//$('#datatable_filter').outerHeight();
                //console.debug(filterInputHeight);
                var tableHeaderHeight = $('thead').first().outerHeight();
                //console.debug(tableHeaderHeight);
                var tableTop = dataTable.offset().top;
                return $(window).innerHeight() - tableTop - tableHeaderHeight - paginationControlsHeight - filterInputHeight;
            }

            /**
             * Requests a confirmation on clicking a link which e.g. deletes something.
             * Uses the link's title attribute to determine the warning message for the dialog.
             * @param event the jquery event to stop the click action if necessary
             */
            function confirmCriticalAction(event){
                if(confirm($(this).attr('title'))){
                    return true;
                } else {
                    event.preventDefault();
                };
            }
            
            {% block additionalJS %}
            {% endblock %}

        </script>
    </body>
</html>