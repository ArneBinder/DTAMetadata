<?xml version="1.0" encoding="utf-8"?>
<!-- 
    Contains cross ref tables and the only entity of the administrative domain (User).
-->

<!--The name attribute refers to the connection to use. See app/config/config.yml under
    propel > dbal > connections for connection setup. -->
<database name="DTAMetadata" namespace="DTA\MetadataBundle\Model" defaultIdMethod="native">
  
    <!-- This parameter set is added to each entity that doesn't implement the table_row_view behavior. 
    It is not added to tables/entities that define the bahavior. -->
    <behavior name="table_row_view">
        <!--If no parameters are defined, all columns are added. (WITHOUT embedding any related entities) -->
    </behavior>
    
    <table name="language_work" isCrossRef="true">
        <column name="language_id" type="INTEGER" primaryKey="true" required="true"/>
        <column name="work_id" type="INTEGER" primaryKey="true" required="true"/>
        <foreign-key foreignTable="language"> <reference local="language_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="work"> <reference local="work_id" foreign="id"/> </foreign-key>
    </table>
    
    <table name="genre_work" isCrossRef="true">
        <column name="genre_id" type="INTEGER" primaryKey="true" required="true"/>
        <column name="work_id" type="INTEGER" primaryKey="true" required="true"/>
        <foreign-key foreignTable="genre"> <reference local="genre_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="work"> <reference local="work_id" foreign="id"/> </foreign-key>
    </table>
    
    <table name="work_tag" isCrossRef="true">
        <column name="tag_id" type="INTEGER" primaryKey="true" required="true"/>
        <column name="work_id" type="INTEGER" primaryKey="true" required="true"/>
        <foreign-key foreignTable="tag"> <reference local="tag_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="work"> <reference local="work_id" foreign="id"/> </foreign-key>
    </table>
    
    <table name="category_work" isCrossRef="true">
        <column name="category_id" type="INTEGER" primaryKey="true" required="true"/>
        <column name="work_id" type="INTEGER" primaryKey="true" required="true"/>
        <foreign-key foreignTable="category"> <reference local="category_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="work"> <reference local="work_id" foreign="id"/> </foreign-key>
    </table>
    
    <table name="publication_publicationGroup" isCrossRef="true">
        <column name="publicationGroup_id" type="INTEGER" primaryKey="true" required="true"/>
        <column name="publication_id" type="INTEGER" primaryKey="true" required="true"/>
        <foreign-key foreignTable="publicationGroup"> <reference local="publicationGroup_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="publication">
            <reference local="publication_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="person_publication" idMethod="native">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="personRole_id" type="INTEGER" required="true"/>
        <column name="person_id" type="INTEGER" required="true"/>
        <column name="publication_id" type="INTEGER" required="true"/>
        
        <foreign-key foreignTable="personRole"> <reference local="personRole_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="person"> <reference local="person_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="publication"> <reference local="publication_id" foreign="id"/> </foreign-key>
    </table>
    
    <table name="person_work" idMethod="native">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="person_id" type="INTEGER" required="true"/>
        <column name="personRole_id" type="INTEGER" required="true"/>
        <column name="work_id" type="INTEGER" required="true"/>
        <foreign-key foreignTable="person"> <reference local="person_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="personRole"> <reference local="personRole_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="work"> <reference local="work_id" foreign="id"/> </foreign-key>
    </table>

    <table name="user" phpName="User">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="username" type="LONGVARCHAR" required="false"/>
        <column name="password" type="VARCHAR" size="512" required="false"/>
        <column name="salt" type="VARCHAR" size="512" required="false"/>
        <column name="mail" type="LONGVARCHAR" required="false"/>
        <column name="phone" type="LONGVARCHAR" required="false"/>
        <column name="admin" type="BOOLEAN" default="false" required="false"/>
        
        <behavior name="table_row_view">
            <parameter name="Id" value="id"/>
            <parameter name="Benutzername" value="username"/>
            <parameter name="Mail" value="mail"/>
            <parameter name="Telefon" value="phone"/>
            <parameter name="Administratorrechte" value="accessor:adminToString"/>
        </behavior>
        
    </table>
</database>
