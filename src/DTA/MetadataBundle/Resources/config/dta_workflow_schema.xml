<?xml version="1.0" encoding="utf-8"?>

<!-- 
    Contains all entities related to the workflow of the project.
    Tasks, tasktypes, related publications, sources, license types, etc.
-->

<database name="DTAMetadata" namespace="DTA\MetadataBundle\Model\Workflow" defaultIdMethod="native">
  
    <!-- This parameter set is added to each entity that doesn't implement the table_row_view behavior. 
    It is not added to tables/entities that define the bahavior. -->
    <behavior name="table_row_view">
        <!--If no parameters are defined, all columns are added. (WITHOUT embedding any related entities) -->
    </behavior>
    
    <!--currently not needed?-->
<!--    <table name="status">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="name" type="LONGVARCHAR" required="true"/>
        <behavior name="table_row_view">
            <parameter name="status" value="name"/>
        </behavior>
    </table>-->

    <table name="task">
        
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="tasktype_id" type="INTEGER" required="true"/>
        <column name="done" type="BOOLEAN"/>
        
        <column name="start_date" type="DATE"/>
        <column name="end_date" type="DATE"/>
        
        <column name="comments" type="LONGVARCHAR"/>
        <column name="publicationgroup_id" type="INTEGER"/>
        <column name="publication_id" type="INTEGER"/>
        <column name="partner_id" type="INTEGER"/>
        <column name="responsibleuser_id" type="INTEGER"/>
        
        <foreign-key foreignTable="tasktype"> <reference local="tasktype_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="publicationgroup"> <reference local="publicationgroup_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="publication"> <reference local="publication_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="partner"> <reference local="partner_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="dta_user"> <reference local="responsibleuser_id" foreign="id"/> </foreign-key>
        
        <behavior name="timestampable"/>
        <behavior name="table_row_view">
            <parameter name="embedColumns1" value="tasktype"/>
            <parameter name="Abgeschlossen" value="done"/>
            <parameter name="Start" value="start_date"/>
            <parameter name="Ende" value="end_date"/>
            <parameter name="Für" value="accessor:getReferee"/>
            <parameter name="Verantwortlich" value="accessor:getResponsibleUser"/>
        </behavior>
    </table>

    <table name="tasktype">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="name" type="LONGVARCHAR" required="true"/>
        <behavior name="nested_set"/>
        <behavior name="table_row_view">
<!--            <parameter name="id" value="id"/>-->
            <parameter name="Zuordnung" value="accessor:getParent"/>
            <parameter name="Typ" value="name"/>
        </behavior>
    </table>
    
    <table name="partner">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="name" type="LONGVARCHAR"/>
        <column description="Ansprechpartner" name="person" type="LONGVARCHAR"/>
        <column name="contact_data" type="LONGVARCHAR"/>
        <column name="comments" type="LONGVARCHAR"/>
        <column name="is_organization" type="BOOLEAN" default="false"/>
    </table>

    <!--Quellenangabe fuer Bilddigitalisate-->
    <table name="imagesource">
        
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="publication_id" type="INTEGER" required="true"/>
       
        <column description="Anbieter Leitdruck" name="partner_id" type="INTEGER"/>
        <column name="cataloguesignature" type="LONGVARCHAR"/>
        <column name="catalogueurl" description="Link in den Katalog" type="LONGVARCHAR"/>
        
        <column description="Anzahl Faksimiles" name="numfaksimiles" type="INTEGER"/>
        <column description="Umfang laut Katalog" name="extentasofcatalogue" type="LONGVARCHAR"/>
        <!--Bilddigitalisate können teilweise aus anderen Quellen kommen.-->
        <column description="Referenzierte Faksimileseitenzahlen" name="faksimilerefrange" type="LONGVARCHAR"/>
        <column description="Referenzierte Originalseitenzahlen" name="originalrefrange" type="LONGVARCHAR"/>

        <column description="URL der Bilddigitalisate" name="imageurl" type="LONGVARCHAR"/>
        <column description="URN der Bilddigitalisate" name="imageurn" type="LONGVARCHAR"/>
        <column name="license_id" description="Lizenz" type="INTEGER"/>
        
        <foreign-key foreignTable="publication"> <reference local="publication_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="license"> <reference local="license_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="partner" onDelete="setnull"> <reference local="partner_id" foreign="id"/> </foreign-key>
    </table>
    
    <!--Quellenangabe fuer Textdigitalisate-->
    <table name="textsource">
        
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="publication_id" type="INTEGER" required="true"/>
       
        <column description="Anbieter Textdigitalisate" name="partner_id" type="INTEGER"/>
        
        <column description="URL der Textdigitalisate" name="texturl" type="LONGVARCHAR"/>
        <column name="license_id" description="Lizenz" type="INTEGER"/>
        <column description="Attributionszeile" name="attribution" type="LONGVARCHAR"/>
        
<!--        <column name="cataloguesignature" type="LONGVARCHAR"/>
        <column name="catalogueurl" description="Link in den Katalog" type="LONGVARCHAR"/>-->
        <!--<column description="URN der Bilddigitalisate" name="imageurn" type="LONGVARCHAR"/>-->
        
        <foreign-key foreignTable="publication"> <reference local="publication_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="license"> <reference local="license_id" foreign="id"/> </foreign-key>
        <foreign-key foreignTable="partner" onDelete="setnull"> <reference local="partner_id" foreign="id"/> </foreign-key>
    </table>
    
    <table name="license">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="name" type="LONGVARCHAR" required="true"/>
        <column name="url" type="LONGVARCHAR"/>
        <!--Ob diese Lizenz auf Bilder anwendbar ist -->
        <column name="applicable_to_image" type="BOOLEAN" required="true" default="false"/>
        <!--Ob diese Lizenz auf Text anwendbar ist -->
        <column name="applicable_to_text" type="BOOLEAN" required="true" default="false"/>
    </table>
    
    <table name="publicationgroup">
        <column name="id" type="INTEGER" primaryKey="true" autoIncrement="true" required="true"/>
        <column name="name" type="LONGVARCHAR" required="true"/>
    </table>
    
</database>
